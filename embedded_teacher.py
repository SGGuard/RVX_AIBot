"""
Embedded Teaching System - генерирует качественные уроки без зависимости от внешнего AI
Заменяет fallback-режим на настоящий embedded AI с встроенным контентом
"""

from dataclasses import dataclass
from typing import Optional
import random

@dataclass
class EmbeddedLesson:
    """Встроенный урок с полной структурой"""
    lesson_title: str
    content: str
    key_points: list[str]
    real_world_example: str
    practice_question: str
    answer_hint: str
    next_topics: list[str]

# ============================================================================
# УРОКИ ПО ТОПИКАМ
# ============================================================================

EMBEDDED_CURRICULUM = {
    "bitcoin": {
        "beginner": EmbeddedLesson(
            lesson_title="Bitcoin: Цифровое золото",
            content="""Bitcoin был создан в 2009 году анонимным разработчиком Сатоши Накамото. 
Это первая успешная криптовалюта, которая решила проблему двойной траты без центрального органа.

Основные особенности Bitcoin:
• Максимальное количество - 21 миллион монет
• Блоки генерируются каждые ~10 минут
• Используется алгоритм SHA-256 для хэширования
• Сеть полностью децентрализована и отказоустойчива

Bitcoin функционирует как протокол денежного трансфера. Каждая транзакция проверяется майнерами,
которые получают награду за добавление нового блока в цепь. Это создает экономический стимул 
для честного поведения сети.""",
            key_points=[
                "Bitcoin - первая криптовалюта, решившая проблему двойной траты",
                "Максимальное предложение 21 млн BTC обеспечивает дефицит и ценность",
                "Proof-of-Work консенсус требует вычислительной работы для валидации блоков",
                "Блокчейн Bitcoin неизменяем и прозрачен - каждый может проверить историю транзакций"
            ],
            real_world_example="El Salvador в 2021 принял Bitcoin как законное средство платежа. Это показало, что криптовалюты могут быть реально использованы в экономике страны для расчетов и хранения стоимости.",
            practice_question="Почему Bitcoin не может быть инфляционным как обычные деньги?",
            answer_hint="Потому что максимальное количество BTC ограничено 21 миллионом монет и этот лимит заложен в протоколе.",
            next_topics=["ethereum", "blockchain", "mining"]
        ),
        "intermediate": EmbeddedLesson(
            lesson_title="Bitcoin: Архитектура и Безопасность",
            content="""Bitcoin использует сложную криптографию для обеспечения безопасности. 
Каждая транзакция подписывается приватным ключом отправителя, что гарантирует, что только владелец может потратить свои монеты.

Механизм консенсуса Proof-of-Work (PoW):
• Майнеры конкурируют в решении сложной математической задачи
• Первый, кто найдет решение, добавляет новый блок и получает награду
• Сложность задачи автоматически регулируется каждые 2016 блоков

Атаки и их предотвращение:
• 51%-атака: требует контролировать 51% хэшрейта сети (экономически нецелесообразно)
• Double-spending: невозможна благодаря Proof-of-Work и иммутабельности блокчейна
• Replay-атака: предотвращается использованием цифровых подписей

Валидация блоков проверяет: подписи транзакций, балансы отправителей, и соответствие правилам консенсуса.""",
            key_points=[
                "ECDSA - эллиптическая криптография защищает приватные ключи",
                "Difficulty adjustment каждые 2 недели сохраняет время блока ~10 минут",
                "UTXO-модель отличается от account-модели - каждая монета отслеживается",
                "Майнеры получают системную награду (halving каждые 4 года) + комиссии за транзакции"
            ],
            real_world_example="Халвинг Bitcoin в 2024 году снизил награду за блок с 6.25 BTC до 3.125 BTC. Это событие поддерживает дефляционный характер Bitcoin и часто вызывает волатильность цены.",
            practice_question="Почему увеличение сложности майнинга делает Bitcoin безопаснее?",
            answer_hint="Потому что требует больше вычислительной работы для атаки на сеть, что делает её экономически нецелесообразной.",
            next_topics=["ethereum", "layer2", "defi"]
        ),
        "advanced": EmbeddedLesson(
            lesson_title="Bitcoin: Масштабирование и будущее",
            content="""Основная проблема Bitcoin - масштабируемость: сеть может обработать ~7 транзакций в секунду.
Это ограничение вызвано размером блока (1 МБ) и временем создания блока (10 минут).

Решения для масштабирования (Layer 2):

Lightning Network:
• Создает платежные каналы между участниками вне основной цепи
• Позволяет микротранзакции с минимальными комиссиями и задержками
• Пропускная способность исчисляется млн транзакций в секунду
• Позволяет платежи между участниками без блокчейна для каждой транзакции

Sidechain (Stacks, RSK):
• Отдельные блокчейны, которые периодически синхронизируются с Bitcoin
• Позволяют разные возможности (смарт-контракты на Stacks)
• Наследуют безопасность Bitcoin через пеггинг

Taproot и будущие обновления:
• Taproot (2021) улучшил приватность и эффективность скриптов
• Майнет 4 (в разработке) добавит больше функциональности""",
            key_points=[
                "Lightning Network решает проблему масштабируемости через платежные каналы",
                "Atomic swaps позволяют прямой обмен между Bitcoin и другими криптовалютами",
                "Taproot улучшил приватность, комбинируя Schnorr-сигнатуры",
                "Дальнейшее развитие Bitcoin может включить больше гибкости смарт-контрактов"
            ],
            real_world_example="Стальвийя внедрил Lightning Network для майнинга. Это позволило создать микротранзакции между майнерами почти без комиссий и мгновенно, демонстрируя практическую полезность Layer 2.",
            practice_question="Почему Lightning Network не требует записывать каждую транзакцию в блокчейн Bitcoin?",
            answer_hint="Потому что участники платежного канала могут обновлять свои балансы хэш-блокировкой, и на цепь записываются только открытие и закрытие канала.",
            next_topics=["ethereum", "sidechains", "defi_advanced"]
        )
    },
    "ethereum": {
        "beginner": EmbeddedLesson(
            lesson_title="Ethereum: Платформа для смарт-контрактов",
            content="""Ethereum запущен в 2015 году Виталиком Бутериным и значительно расширил возможности блокчейна.
В отличие от Bitcoin, Ethereum - это платформа для запуска программ (смарт-контрактов) на блокчейне.

Основные компоненты:
• EVM (Ethereum Virtual Machine) - виртуальная машина, которая выполняет код контрактов
• Smart Contracts - программы, которые автоматически выполняются когда условия выполнены
• Ether (ETH) - криптовалюта, используемая для оплаты комиссий (gas)
• Аккаунт-модель - у каждого адреса есть баланс, а не отслеживание монет

Что отличает Ethereum от Bitcoin:
• Полнота по Тьюрингу - на Ethereum можно создавать программы любой сложности
• Состояние (state) - Ethereum хранит состояние всех контрактов
• Gas - плата за выполнение каждой операции, что предотвращает бесконечные циклы

Ethereum использует Proof-of-Stake (начиная с 2022 года "The Merge"), где валидаторы выбираются на основе
количества поставленных (staked) токенов, а не вычислительной мощности.""",
            key_points=[
                "Ethereum позволяет создавать децентрализованные приложения (dApps) через смарт-контракты",
                "Gas-система предотвращает спам и бесконечные циклы кода",
                "Proof-of-Stake (PoS) более энергоэффективен чем Proof-of-Work",
                "Ether используется как валюта и как топливо для выполнения программ"
            ],
            real_world_example="Uniswap - децентрализованная биржа на Ethereum, позволяет торговать токенами без центрального органа. Смарт-контракты автоматически управляют ликвидностью и ценообразованием через AMM (Automated Market Maker).",
            practice_question="Почему неправильно написанный смарт-контракт с бесконечным циклом не создает проблему для сети Ethereum?",
            answer_hint="Потому что код просто закончится, когда деньги на счете исчерпаны (механизм Gas), что предотвращает бесконечное выполнение.",
            next_topics=["smart_contracts", "defi", "web3"]
        ),
        "intermediate": EmbeddedLesson(
            lesson_title="Ethereum: Smart Contracts и Solidity",
            content="""Smart контракты - это программы, хранящиеся на блокчейне, которые автоматически выполняются 
при выполнении определенных условий. Большинство смарт-контрактов на Ethereum написаны на языке Solidity.

Solidity основы:
• Язык программирования похож на JavaScript и C++
• Контракты развертываются на адреса и имеют состояние
• Функции контракта могут быть вызваны любым адресом через транзакцию

Важные концепции:
• State variables - данные, которые сохраняются в блокчейне между вызовами
• Functions - вызываемый код, может читать/изменять состояние
• Events - логируют события, на которые могут подписаться приложения
• Visibility - public, private, internal, external

Gas и оптимизация:
• Каждая операция имеет стоимость в Gas (например, SSTORE стоит 20000 gas)
• Разработчики должны оптимизировать код, чтобы снизить стоимость
• Хранение данных (storage) дороже, чем вычисления (computation)

Безопасность контрактов - критична, так как ошибки могут привести к потере денег.""",
            key_points=[
                "Solidity требует тщательной обработки ошибок и безопасности кода",
                "Reentrancy - одна из самых опасных уязвимостей, позволяет воровать средства",
                "Проверка входных данных (input validation) предотвращает многие атаки",
                "Модульность кода и использование проверенных библиотек (OpenZeppelin) повышает безопасность"
            ],
            real_world_example="Hack DAO в 2016 году показал опасность reentrancy атак. Хакер использовал ошибку в смарт-контракте The DAO, чтобы вывести 60 млн долларов ETH, что привело к hard fork Ethereum.",
            practice_question="Что такое reentrancy и почему она опасна?",
            answer_hint="Это атака, когда контракт может быть вызван множество раз до обновления его состояния, позволяя вывести больше денег чем есть.",
            next_topics=["defi", "token_standards", "layer2"]
        ),
        "advanced": EmbeddedLesson(
            lesson_title="Ethereum: EIP и Roadmap развития",
            content="""Ethereum постоянно развивается через предложения EIP (Ethereum Improvement Proposals).
Каждый EIP предлагает изменение протокола, которое обсуждается сообществом перед внедрением.

Важные EIP и hard forks:
• EIP-1559 (London 2021) - переработал механизм комиссий, добавил базовую комиссию и сжигание токенов
• EIP-2200 (Istanbul 2019) - изменил стоимость операций с хранилищем
• EIP-3675 (Paris 2022) - завершил переход на Proof-of-Stake ("The Merge")
• EIP-4844 (Dencun 2024) - добавил proto-danksharding для масштабирования

Roadmap Ethereum (Dencun и позже):
• Proto-danksharding - промежуточное решение для масштабирования L2
• Danksharding - полная реализация шардинга для масштабирования
• Verkle trees - новая структура данных для более эффективного состояния

Развитие Ethereum направлено на:
• Масштабируемость - обработка больше транзакций
• Энергоэффективность - PoS уже достигнута
• Безопасность - постоянное улучшение протокола
• Приватность - развитие инструментов для конфиденциальности

L2 решения (Arbitrum, Optimism, zkSync) частично уже решают масштабируемость,
а proto-danksharding даст им больше пропускной способности.""",
            key_points=[
                "EIP-1559 создал дефляционный механизм для ETH через сжигание базовой комиссии",
                "Переход на PoS уменьшил энергопотребление Ethereum на 99.95%",
                "Proto-danksharding (EIP-4844) улучшит масштабируемость L2 решений на 10-100x",
                "Verkle trees позволят узлам работать с меньшей памятью, улучшая децентрализацию"
            ],
            real_world_example="Dencun upgrade в марте 2024 добавил EIP-4844, что снизило комиссии на Arbitrum и Optimism в 5-100 раз. Пользователи стали платить копейки вместо долларов за транзакции.",
            practice_question="Почему EIP-1559 сделала ETH дефляционным?",
            answer_hint="Потому что базовая комиссия сжигается (удаляется из циркуляции), а если комиссии превышают вознаграждение валидаторов, общее количество ETH уменьшается.",
            next_topics=["defi_advanced", "layer2", "zk_proofs"]
        )
    },
    "blockchain": {
        "beginner": EmbeddedLesson(
            lesson_title="Блокчейн: Основы распределенной книги",
            content="""Блокчейн - это распределенная база данных, которая хранит информацию в цепочке криптографически 
связанных блоков. Каждый блок содержит хеш предыдущего блока, что создает неразрывную цепь.

Основные принципы:
• Децентрализация - нет единого сервера, данные копируются на многих узлах
• Иммутабельность - раз добавленные данные невозможно изменить без пересчета всей цепи
• Прозрачность - все могут просмотреть всю историю транзакций
• Консенсус - узлы должны согласиться на новый блок перед добавлением

Структура блока:
• Header - метаданные (номер, время, родитель, merkle root)
• Transactions - список транзакций
• Nonce - число для Proof-of-Work

Как это работает:
1. Новая транзакция обходит сеть к узлам
2. Узлы проверяют валидность транзакции
3. Валидные транзакции попадают в mempool (пул памяти)
4. Майнеры/валидаторы выбирают транзакции и создают новый блок
5. Новый блок проверяется и распространяется по сети
6. Все узлы обновляют свои копии блокчейна""",
            key_points=[
                "Хеширование каждого блока включает хеш предыдущего, создавая неразрывную цепь",
                "Любое изменение данных в историческом блоке требует пересчета всех последующих блоков",
                "Сеть многих узлов делает невозможным подделать историю без контроля большинства",
                "Механизм консенсуса (PoW, PoS) предотвращает сбои и дает экономический стимул честности"
            ],
            real_world_example="Bitcoin блокчейн содержит все транзакции с 2009 года - более 800 млн транзакций. Размер всей цепи около 600 GB. Любой может загрузить полный узел и проверить каждую транзакцию самостоятельно.",
            practice_question="Почему попытка изменить старую транзакцию в блокчейне немедленно станет очевидна всем?",
            answer_hint="Потому что хеш этого блока изменится, что нарушит цепь и все компьютеры в сети смогут обнаружить подделку.",
            next_topics=["cryptography", "bitcoin", "ethereum"]
        ),
        "intermediate": EmbeddedLesson(
            lesson_title="Блокчейн: Консенсус и масштабируемость",
            content="""Консенсус - механизм, который позволяет распределенной сети согласиться на состояние блокчейна
без центрального органа. Различные механизмы обеспечивают разные свойства.

Основные механизмы консенсуса:

Proof-of-Work (PoW):
• Участники (майнеры) конкурируют в решении математических задач
• Первый, кто решит, добавляет блок и получает награду
• Сложность автоматически регулируется
• Плюсы: высокая безопасность, проверенный временем
• Минусы: энергозатратность, сложность масштабирования

Proof-of-Stake (PoS):
• Валидаторы выбираются на основе количества поставленных токенов
• Менее энергозатратен, позволяет быстрее добавлять блоки
• Плюсы: экономичность, масштабируемость
• Минусы: требует изначального распределения токенов, риск централизации

DPoS (Delegated PoS):
• Токенхолдеры голосуют за делегатов, которые валидируют блоки
• Примеры: Cosmos, EOS
• Более демократичен и эффективен

Масштабируемость:
• Trilemma: безопасность, децентрализация, масштабируемость
• На Layer 1 трудно иметь все три свойства одновременно
• Layer 2 решения (Rollups, Sidechains) решают триллему на своем уровне""",
            key_points=[
                "Konsensus должен предотвращать двойную трату и 51% атаки",
                "Proof-of-Stake требует экономического стимула честного поведения (slashing)",
                "Финальность - время, необходимое для гарантии необратимости транзакции",
                "Скейлинг: Rollups компрессируют транзакции, Sharding делит сеть, Sidechains работают параллельно"
            ],
            real_world_example="Ethereum переходит с PoW на PoS. The Merge в 2022 году уменьшил энергопотребление на 99.95% при сохранении безопасности благодаря механизму Slashing (штрафу за нечестное поведение валидаторов).",
            practice_question="Почему Proof-of-Stake дешевле чем Proof-of-Work?",
            answer_hint="Потому что валидаторам не нужно выполнять сложные математические расчеты, только выполнять вычислительно легкие проверки подписей.",
            next_topics=["ethereum", "layer2", "defi"]
        ),
        "advanced": EmbeddedLesson(
            lesson_title="Блокчейн: Криптографические основы",
            content="""Криптография - основа безопасности всех блокчейнов. Понимание математических принципов
критично для оценки безопасности системы.

Элементы криптографии в блокчейне:

Криптографическое хеширование:
• SHA-256 (Bitcoin) и Keccak-256 (Ethereum) - однонаправленные функции
• Свойства: детерминированность, лавинный эффект, коллизионная стойкость
• Используется для: Proof-of-Work, структур данных (Merkle tree), обнаружения изменений

Асимметричная криптография (ECDSA):
• Каждый адрес имеет приватный и публичный ключ
• Приватный ключ подписывает транзакции, публичный проверяет подпись
• Эллиптическая кривая secp256k1 используется в Bitcoin/Ethereum
• Безопасность зависит от сложности дискретного логарифма

Цифровые подписи:
• Гарантируют, что транзакция подписана только владельцем приватного ключа
• Не требует передачи приватного ключа
• Неоспоримость - подписант не может отрицать свою подпись

Будущее криптографии:
• Квантовые компьютеры угрожают ECDSA
• Post-quantum cryptography разрабатывается NIST
• Lattice-based cryptography (CRYSTALS-Kyber) - потенциальная замена""",
            key_points=[
                "Криптографическое хеширование создает уникальный отпечаток данных, неизменяемый при изменении входа",
                "ECDSA обеспечивает аутентичность и неоспоримость транзакций",
                "Merkle trees позволяют эффективно проверять наличие данных в большом наборе",
                "Квантовое вычисление представляет долгосрочный риск для текущих криптографических алгоритмов"
            ],
            real_world_example="Все биржи и кошельки используют ECDSA для подписания транзакций. Если кто-то получит ваш приватный ключ, он может выдать себя за вас и забрать все средства, потому что не может быть доказано, что это не вы.",
            practice_question="Почему невозможно подделать подпись, если у вас есть только публичный ключ?",
            answer_hint="Потому что создание действительной подписи требует знания приватного ключа, и обратное преобразование (восстановление приватного ключа из публичного) математически невозможно.",
            next_topics=["bitcoin", "zero_knowledge", "quantum_security"]
        )
    },
    "defi": {
        "beginner": EmbeddedLesson(
            lesson_title="DeFi: Финансы без посредников",
            content="""DeFi (Decentralized Finance) - это система финансовых приложений, построенных на блокчейне,
которые имитируют традиционные финансовые услуги, но без посредников.

Основные компоненты DeFi:

Децентрализованные биржи (DEX):
• Uniswap, Curve, Balancer - позволяют торговать токенами напрямую
• Используют AMM (Automated Market Maker) вместо порядков на книге
• Пользователи предоставляют ликвидность и получают комиссию

Кредитование:
• Aave, Compound - позволяют одалживать и занимать криптоактивы
• Интерес определяется спросом и предложением автоматически
• Требует залога (collateral) для защиты от дефолта

Стейкинг и фарминг:
• Можно зарабатывать % на активах, зафиксировав их в контрактах
• Yield farming - комбинирование стейкинга и кредитования для большего дохода

Преимущества:
• Открыт для всех - не нужна банковская лицензия
• Прозрачность - все операции видны на блокчейне
• Эффективность - нет промежуточных учреждений
• Доступность 24/7 - нет выходных и праздников

Недостатки:
• Высокий риск - ошибки кода могут привести к потере денег
• Волатильность - цены могут упасть ниже залога
• Сложность - требует понимания умных контрактов""",
            key_points=[
                "AMM позволяет торговлю через формулу x*y=k вместо порядков на книге",
                "Максимальное достижение скорости и доступности благодаря децентрализации",
                "Риск смарт-контрактов выше чем в традиционных финансах из-за новизны технологии",
                "Сочетание различных протоколов создает сложные цепи риска"
            ],
            real_world_example="Uniswap позволил любому создать торговую пару без разрешения. За несколько лет Uniswap обработал триллионы долларов в объеме, доказав, что DEX может конкурировать с традиционными биржами.",
            practice_question="Почему DEX более безопасны для неквалифицированных трейдеров?",
            answer_hint="Потому что вы сохраняете контроль над своими приватными ключами и средствами не остаются на централизованной бирже, которая может быть взломана.",
            next_topics=["ethereum", "token_standards", "yield_farming"]
        ),
        "intermediate": EmbeddedLesson(
            lesson_title="DeFi: Протоколы и стратегии",
            content="""Продвинутые DeFi протоколы предоставляют более сложные финансовые инструменты.

Типы DeFi приложений:

Мультиколлатеральные системы:
• MakerDAO - создает децентрализованную стейблкойну DAI из различных колатералей
• Требует переизбыточного залога (150-200%) для защиты от нестабильности
• DAI использует Pricefeed Oracle для определения цены колатерали

Производные:
• Synthetix - синтетические активы, отслеживающие цены реальных активов
• Perpetual DEX - позволяют short/long с левереджем
• Примеры: GMX, dYdX

Flash loans:
• Займи большую сумму на одну транзакцию без залога
• Должны быть возвращены в той же транзакции + комиссия
• Используются для арбитража и атак

Стратегии доходности:
• Yield farming - комбинирование LP + кредитования для максимизации дохода
• Liquidation farming - профит на ликвидации неправильно колатерализованных позиций
• MEV (Maximum Extractable Value) - стратегии использования упорядочения транзакций

Риски DeFi:
• Impermanent Loss (IL) - потери для LP при высокой волатильности
• Oracle манипуляция - атаки на источники данных цены
• Flash loan атаки - использование flash loans для манипуляции ценами
• Systemic risk - коллапс одного протокола может вызвать каскадные отказы""",
            key_points=[
                "Переизбыток колатерализации необходим для защиты протокола от падения цены",
                "Flash loans - инновация, создали новый класс атак и стратегий",
                "Oracle problem - децентрализованные системы нуждаются в надежных источниках данных",
                "Комбинирование протоколов создает риск, где отказ одного вызывает каскадный эффект"
            ],
            real_world_example="Hack Curve в 2023 году использовал заражение Oracle, чтобы манипулировать ценой и заработать на ликвидациях. Протокол потерял $52 млн, показав, что даже проверенные системы уязвимы.",
            practice_question="Почему Impermanent Loss происходит в AMM при высокой волатильности?",
            answer_hint="Потому что AMM поддерживает постоянное соотношение пула, которое может быть менее выгодно чем просто держать токены при сильной волатильности.",
            next_topics=["ethereum", "risk_management", "layer2"]
        ),
        "advanced": EmbeddedLesson(
            lesson_title="DeFi: Архитектура и управление",
            content="""Сложные DeFi экосистемы требуют понимания межпротокольного взаимодействия, управления и архитектуры.

Governance токены:
• UNI, AAVE, COMPOUND - дают право голоса по развитию протокола
• Holder могут голосовать на предложения параметров (fees, иммунитеты)
• Multi-sig для критических функций (обновление, пауза, ликвидность)

Архитектура DeFi:

Core Layer (Основной слой):
• DEX (Uniswap) - базовая торговля
• Lending (Aave) - кредитование

Middleware (Промежуточный слой):
• Aggregators (1inch, Paraswap) - маршрутизируют через лучший путь
• Routers (Zapper, Balancer) - комбинируют несколько операций

Application Layer (Слой приложений):
• Yield optimizers (Yearn) - автоматически находят лучший yield
• Portfolio managers - управляют диверсифицированными позициями

Риск-менеджмент в DeFi:
• Stress testing - моделирование экстремальных рыночных условий
• Circuit breakers - остановка торговли при скачках цены
• Insurance - протоколы (Nexus Mutual) страхуют смарт-контракты

Будущее DeFi:
• Cross-chain DeFi - взаимодействие между блокчейнами
• Privacy - использование ZK для конфиденциальности
• Compliance - регуляторные решения для институциональных пользователей
• Native yields - встроенные способы заработка (staking rewards)""",
            key_points=[
                "Модульная архитектура DeFi позволяет комбинировать протоколы, но добавляет сложность рисков",
                "Governance токены создают стимулы для участия, но также концентрируют власть",
                "Риск кредитных цепей (A зависит от B зависит от C) требует постоянного мониторинга",
                "Регуляция DeFi будет ключевой для массового принятия, особенно для стейблкойнов и синтетических активов"
            ],
            real_world_example="Yearn.finance создал архитектуру, где пользователи депонируют средства и автоматическое управление находит лучшие yield стратегии. Это показало как абстрактная сложность может быть скрыта от пользователей через UX.",
            practice_question="Почему governance токены важны для децентрализованных протоколов?",
            answer_hint="Потому что позволяют сообществу голосовать по важным решениям, предотвращая контроль одного человека и обеспечивая демократическое управление.",
            next_topics=["ethereum", "cross_chain", "zk_proofs"]
        )
    }
}

def get_embedded_lesson(topic: str, difficulty: str = "beginner") -> Optional[EmbeddedLesson]:
    """Получить встроенный урок по топику и уровню сложности"""
    topic_lower = topic.lower().strip()
    difficulty_lower = difficulty.lower().strip()
    
    if topic_lower not in EMBEDDED_CURRICULUM:
        return None
    
    lessons = EMBEDDED_CURRICULUM[topic_lower]
    if difficulty_lower not in lessons:
        # Возвращаем beginner если запрошена несуществующая сложность
        return lessons.get("beginner")
    
    return lessons[difficulty_lower]

def get_all_topics() -> list[str]:
    """Получить список всех доступных топиков"""
    return list(EMBEDDED_CURRICULUM.keys())

def get_difficulties_for_topic(topic: str) -> list[str]:
    """Получить доступные уровни сложности для топика"""
    topic_lower = topic.lower().strip()
    if topic_lower not in EMBEDDED_CURRICULUM:
        return []
    return list(EMBEDDED_CURRICULUM[topic_lower].keys())
