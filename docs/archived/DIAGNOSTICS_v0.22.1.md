# RVX Backend - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ v0.22.1

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–ë–æ—Ç –±—ã–ª —Å–ª–æ–º–∞–Ω - –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–ª:
```
–ò–∑–≤–∏–Ω–∏, —Å–µ–π—á–∞—Å —è –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ! ü§î
```

## üîç –ê–Ω–∞–ª–∏–∑ –ü—Ä–æ–±–ª–µ–º—ã

### –ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞
–í `ai_dialogue.py` —Ñ—É–Ω–∫—Ü–∏—è `get_ai_response_sync()` –ª–æ–≤–∏–ª–∞ –≤—Å–µ –æ—à–∏–±–∫–∏ –∏ **–º–æ–ª—á–∞ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ None** –±–µ–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

```python
# –î–û (v0.22.0) - –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
except Exception as e:
    logger.warning(f"‚ö†Ô∏è Gemini sync error: {e}")
    return None  # ‚Üê –ú–û–õ–ß–ê–õ–ò–í–´–ô –û–¢–ö–ê–ó
```

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –û—à–∏–±–∫–∏

1. **Gemini API** - HTTP 200 ‚úÖ –Ω–æ:
   - –û—Ç–≤–µ—Ç –±—ã–ª –ø—É—Å—Ç–æ–π (no `parts` in content)
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
   - –†–µ—à–µ–Ω–∏–µ: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û v0.22.1

2. **DeepSeek API** - HTTP 402 ‚ùå
   - Payment Required - –∫–æ–Ω—á–∏–ª—Å—è –±–∞–ª–∞–Ω—Å
   - –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
   - –ù–æ —ç—Ç–æ OK - Gemini —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä

## ‚úÖ –†–µ—à–µ–Ω–∏–µ (v0.22.1)

### 1. –ü–æ–ª–Ω–æ–µ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –û—à–∏–±–æ–∫

–¢–µ–ø–µ—Ä—å **–ö–ê–ñ–î–ê–Ø** –æ—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:

```python
# –ü–û–°–õ–ï (v0.22.1) - –ü–†–ê–í–ò–õ–¨–ù–û:
logger.info(f"üîÑ –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Gemini...")
logger.debug(f"üìç Gemini URL: {url[:100]}...")
logger.debug(f"üìä Gemini HTTP —Å—Ç–∞—Ç—É—Å: {response.status_code}")

if response.status_code == 200:
    logger.info(f"‚úÖ Gemini —É—Å–ø–µ—à–Ω–æ: {len(ai_response)} —Å–∏–º–≤–æ–ª–æ–≤")
    
elif response.status_code == 401:
    logger.error(f"‚ùå –ü–†–û–í–ï–†–¨–¢–ï GEMINI_API_KEY –í .env!")
    
elif response.status_code == 402:
    logger.error(f"‚ùå –ö–û–ù–ß–ò–õ–°–Ø –ë–ê–õ–ê–ù–°!")

# –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ HTTP –∫–æ–¥–∞...
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ü–∞—Ä—Å–∏–Ω–≥ Gemini

–ü—Ä–æ–±–ª–µ–º–∞: Gemini –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø—É—Å—Ç–æ–π `content` —Å –ø—É—Å—Ç—ã–º `parts` –º–∞—Å—Å–∏–≤–æ–º

**–î–æ:**
```python
ai_response = data["candidates"][0]["content"]["parts"][0]["text"].strip()
# ‚Üë KeyError –µ—Å–ª–∏ parts –ø—É—Å—Ç!
```

**–ü–æ—Å–ª–µ:**
```python
candidates = data.get("candidates", [])
if candidates:
    parts = candidates[0].get("content", {}).get("parts", [])
    if parts:
        ai_response = parts[0].get("text", "").strip()
        if ai_response:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –ø—É—Å—Ç
            return ai_response
```

### 3. –õ—É—á—à–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ó–∞–ø—Ä–æ—Å–∞ –∫ Gemini

–ò–∑–º–µ–Ω–∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:

```python
# –¢–µ–ø–µ—Ä—å –µ–¥–∏–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤–º–µ—Å—Ç–æ —Ä–∞–∑–±–∏—Ç–æ–≥–æ
full_prompt = f"{system_prompt}\n\n{context_str}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_message}"

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Gemini
response = client.post(
    url,
    json={
        "contents": [{
            "parts": [{
                "text": full_prompt  # ‚Üê –ï–¥–∏–Ω—ã–π —Ç–µ–∫—Å—Ç
            }]
        }],
        "generationConfig": {
            "temperature": 0.7,
            "maxOutputTokens": 200,
            "topP": 0.95
        }
    }
)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

‚úÖ **Gemini —Ä–∞–±–æ—Ç–∞–µ—Ç!**
```
–ó–∞–ø—Ä–æ—Å: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç—ã?"
–û—Ç–≤–µ—Ç: "–ü—Ä–∏–≤–µ—Ç! –û—Ç–ª–∏—á–Ω–æ, –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å —Ç–µ–±–µ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –º–∏—Ä–µ –∫—Ä–∏–ø—Ç—ã –∏ –Ω–æ–≤–æ—Å—Ç—è—Ö! üöÄ"
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å —Ç–æ—á–Ω–æ–µ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

```
ai_dialogue - INFO - üîÑ –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Gemini...
ai_dialogue - DEBUG - üìç Gemini URL: https://generativelanguage.googleapis.com/...
ai_dialogue - DEBUG - üìä Gemini HTTP —Å—Ç–∞—Ç—É—Å: 200
ai_dialogue - INFO - ‚úÖ Gemini —É—Å–ø–µ—à–Ω–æ –≤–µ—Ä–Ω—É–ª –æ—Ç–≤–µ—Ç (107 —Å–∏–º–≤–æ–ª–æ–≤)
ai_dialogue - DEBUG - üí¨ –û—Ç–≤–µ—Ç: –ü—Ä–∏–≤–µ—Ç! –û—Ç–ª–∏—á–Ω–æ, –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å...
```

## üöÄ –°—Ç–∞—Ç—É—Å –°–∏—Å—Ç–µ–º

### API Server (api_server.py)
‚úÖ **–ó–ê–ü–£–©–ï–ù –ò –ó–î–û–†–û–í**
- DeepSeek client: ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- Gemini client: ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: ‚úÖ –í–∫–ª—é—á–µ–Ω–æ
- Rate limiting: ‚úÖ 10 –∑–∞–ø—Ä–æ—Å–æ–≤/60s

### Telegram Bot (bot.py)
‚úÖ **–ó–ê–ü–£–©–ï–ù –ò –ì–û–¢–û–í**
- –í–µ—Ä—Å–∏—è: 0.20.0
- –î–∏–∞–ª–æ–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞: ‚úÖ v0.22.1 (–†–ï–ê–õ–¨–ù–´–ô –ò–ò)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π: ‚úÖ –ß–µ—Ä–µ–∑ ai_dialogue
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: ‚úÖ –í–∫–ª—é—á–µ–Ω–∞

## üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)

```
‚úÖ GEMINI_API_KEY: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ GEMINI_MODEL: gemini-2.5-flash (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
‚úÖ DEEPSEEK_API_KEY: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–Ω–æ –∫–æ–Ω—á–∏–ª—Å—è –±–∞–ª–∞–Ω—Å - —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è)
‚úÖ DEEPSEEK_MODEL: deepseek-chat
‚úÖ API URLs: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ
```

## üîÆ –ß—Ç–æ –î–µ–ª–∞—Ç—å –î–∞–ª—å—à–µ

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ
1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–æ—Ç
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç (–∞ –Ω–µ "–ò–∑–≤–∏–Ω–∏, —Å–µ–π—á–∞—Å —è –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å")

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è
2. **–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å DeepSeek** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: 402 Payment Required
   - DeepSeek –æ—Å—Ç–∞—ë—Ç—Å—è fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
   - Gemini –æ—Å–Ω–æ–≤–Ω–æ–π –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏** (–≤–∞–∂–Ω–æ!)
   - `tail -f /tmp/bot.log` - –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
   - –ù–æ–≤—ã–µ –ª–æ–≥–∏ v0.22.1 –ø–æ–∫–∞–∂—É—Ç –¢–û–ß–ù–û —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

### –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–Ω—ã–µ –ª–æ–≥–∏: `cat /tmp/bot.log | tail -100`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã: `ps aux | grep python`
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –±–æ—Ç—ã: `pkill -f bot.py && pkill -f api_server`

## üìù –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

- **v0.22.0**: –ü–µ—Ä–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ò–ò –¥–∏–∞–ª–æ–≥–∞ (—Å–ª–æ–º–∞–Ω–∞ - –º–æ–ª—á–∞–ª–∏–≤—ã–µ –æ—à–∏–±–∫–∏)
- **v0.22.1**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ Gemini

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–û v0.22.1:**
```
‚ùå –ë–æ—Ç: "–ò–∑–≤–∏–Ω–∏, —Å–µ–π—á–∞—Å —è –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ! ü§î"
‚ùå –ù–∏–∫–∞–∫–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É
```

**–ü–û–°–õ–ï v0.22.1:**
```
‚úÖ –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –†–ï–ê–õ–¨–ù–´–ï –æ—Ç–≤–µ—Ç—ã –æ—Ç Gemini –ò–ò
‚úÖ –ö–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
‚úÖ –õ–µ–≥–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
‚úÖ Fallback –Ω–∞ DeepSeek –µ—Å–ª–∏ Gemini –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
```

## üèÅ –í—ã–≤–æ–¥—ã

1. **–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - Gemini –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–µ** - –≤–∏–¥–∏–º –í–°–ï –æ—à–∏–±–∫–∏ —Å HTTP –∫–æ–¥–∞–º–∏
3. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å—Ç–∞** - –ø—Ä–æ—Å—Ç–æ —Å–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –ò–ò (Claude, GPT-4, –∏ —Ç.–¥.)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-08  
**–í–µ—Ä—Å–∏—è:** v0.22.1  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–û
