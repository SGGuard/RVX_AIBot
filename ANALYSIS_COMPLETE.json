{
  "analysis_metadata": {
    "project": "rvx_backend",
    "file_analyzed": "bot.py",
    "analysis_date": "2025-12-26",
    "language": "Russian (Русский)",
    "total_lines": 14730,
    "analysis_type": "Russian text handler structure analysis"
  },
  "executive_summary": {
    "total_handlers": 135,
    "handlers_with_russian_text": 135,
    "total_categories": 13,
    "total_russian_text_instances": 742,
    "unique_russian_strings": 700,
    "duplicated_strings": 27,
    "total_code_length_bytes": 513191,
    "average_handler_size_bytes": 3801
  },
  "critical_issues": [
    {
      "priority": "CRITICAL",
      "issue": "button_callback too large",
      "details": "136 KB, 195 Russian text instances, ~3600 lines",
      "impact": "Difficult to maintain, test, and navigate",
      "solution": "Split into 10-15 separate handlers using Dispatcher pattern",
      "estimated_effort": "3-4 days"
    },
    {
      "priority": "CRITICAL",
      "issue": "Russian text duplication",
      "details": "27 strings used in 2+ handlers",
      "impact": "Hard to maintain translations, code duplication",
      "solution": "Create constants.py or STRINGS dict with all Russian text",
      "estimated_effort": "1-2 days"
    },
    {
      "priority": "HIGH",
      "issue": "Incomplete i18n system",
      "details": "Not all Russian text is localized",
      "impact": "Cannot fully support multiple languages",
      "solution": "Expand i18n module for complete coverage",
      "estimated_effort": "2-3 days"
    }
  ],
  "categories_breakdown": {
    "Прочее": {
      "count": 54,
      "russian_texts": 232,
      "avg_per_handler": 4.3,
      "total_bytes": 176738,
      "largest": "main (37 texts, 33KB)"
    },
    "Меню/Кнопки": {
      "count": 3,
      "russian_texts": 199,
      "avg_per_handler": 66.3,
      "total_bytes": 138307,
      "largest": "button_callback (195 texts, 136KB)"
    },
    "Помощь/Команды": {
      "count": 24,
      "russian_texts": 77,
      "avg_per_handler": 3.2,
      "total_bytes": 44587,
      "largest": "ask_command (10 texts)"
    },
    "Закладки": {
      "count": 9,
      "russian_texts": 73,
      "avg_per_handler": 8.1,
      "total_bytes": 17944,
      "largest": "show_bookmarks_by_type (47 texts)"
    },
    "Обработка сообщений": {
      "count": 6,
      "russian_texts": 54,
      "avg_per_handler": 9.0,
      "total_bytes": 46572,
      "largest": "handle_message (29 texts)"
    },
    "Квесты/Задачи": {
      "count": 13,
      "russian_texts": 29,
      "avg_per_handler": 2.2,
      "total_bytes": 17344,
      "largest": "show_daily_quests_menu (8 texts)"
    },
    "Профиль пользователя": {
      "count": 6,
      "russian_texts": 19,
      "avg_per_handler": 3.2,
      "total_bytes": 11909,
      "largest": "format_user_profile (13 texts)"
    },
    "Обучение": {
      "count": 5,
      "russian_texts": 19,
      "avg_per_handler": 3.8,
      "total_bytes": 19693,
      "largest": "_launch_teaching_lesson (7 texts)"
    },
    "Статистика/Лидерборд": {
      "count": 7,
      "russian_texts": 17,
      "avg_per_handler": 2.4,
      "total_bytes": 14353,
      "largest": "stats_command (5 texts)"
    },
    "История": {
      "count": 3,
      "russian_texts": 11,
      "avg_per_handler": 3.7,
      "total_bytes": 5335,
      "largest": "ensure_conversation_history_columns (9 texts)"
    },
    "Начало/Главное меню": {
      "count": 3,
      "russian_texts": 9,
      "avg_per_handler": 3.0,
      "total_bytes": 18509,
      "largest": "start_command (4 texts)"
    },
    "Калькулятор/Крипто": {
      "count": 1,
      "russian_texts": 2,
      "avg_per_handler": 2.0,
      "total_bytes": 1494,
      "largest": "send_crypto_digest"
    },
    "Администрирование": {
      "count": 1,
      "russian_texts": 1,
      "avg_per_handler": 1.0,
      "total_bytes": 406,
      "largest": "admin_only"
    }
  },
  "top_duplicated_texts": [
    {
      "rank": 1,
      "text": "Назад",
      "count": 6,
      "handlers": ["calculator_command", "start_course_command", "bookmarks_command", "handle_start_course_callback", "learn_command", "button_callback"],
      "recommendation": "Create BUTTONS.BACK constant"
    },
    {
      "rank": 2,
      "text": "Для использования этого бота необходимо подписаться на наш канал.",
      "count": 3,
      "handlers": ["button_callback", "require_channel_subscription", "handle_message"],
      "recommendation": "Create MESSAGES.SUBSCRIPTION_REQUIRED constant"
    },
    {
      "rank": 3,
      "text": "Первый урок",
      "count": 2,
      "handlers": ["button_callback", "format_user_profile"],
      "recommendation": "Use BADGES enum"
    },
    {
      "rank": 4,
      "text": "Первый тест",
      "count": 2,
      "handlers": ["button_callback", "format_user_profile"],
      "recommendation": "Use BADGES enum"
    },
    {
      "rank": 5,
      "text": "Первый вопрос",
      "count": 2,
      "handlers": ["button_callback", "format_user_profile"],
      "recommendation": "Use BADGES enum"
    }
  ],
  "handler_size_distribution": {
    "0-1000_bytes": 45,
    "1001-5000_bytes": 60,
    "5001-10000_bytes": 20,
    "10001_plus_bytes": 10
  },
  "async_sync_distribution": {
    "async_handlers": 65,
    "sync_handlers": 70,
    "percentage_async": 48.1
  },
  "russian_text_distribution": {
    "1-5_texts": 95,
    "6-20_texts": 30,
    "21-50_texts": 8,
    "51_plus_texts": 2,
    "note": "button_callback has 195 (extremely high)"
  },
  "output_files": {
    "json_analysis": {
      "filename": "RUSSIAN_TEXT_HANDLERS_ANALYSIS.json",
      "type": "JSON",
      "size": "~50 KB",
      "purpose": "Structured data for automated analysis and tools"
    },
    "markdown_analysis": {
      "filename": "RUSSIAN_TEXT_HANDLERS_ANALYSIS.md",
      "type": "Markdown",
      "size": "~30 KB",
      "purpose": "Human-readable detailed analysis and recommendations"
    },
    "handlers_examples": {
      "filename": "HANDLERS_EXAMPLES_AND_PATTERNS.md",
      "type": "Markdown with Code",
      "size": "~40 KB",
      "purpose": "Examples and patterns for learning and refactoring"
    },
    "summary": {
      "filename": "ANALYSIS_SUMMARY.md",
      "type": "Markdown",
      "size": "~20 KB",
      "purpose": "Quick reference and action plan"
    }
  },
  "refactoring_roadmap": {
    "phase_1": {
      "name": "Critical Fixes (2-3 weeks)",
      "priority": "CRITICAL",
      "tasks": [
        "Split button_callback into 10+ handlers",
        "Create constants.py with Russian strings",
        "Implement Dispatcher pattern",
        "Add type hints to all functions"
      ]
    },
    "phase_2": {
      "name": "Architecture Improvements (1-2 weeks)",
      "priority": "HIGH",
      "tasks": [
        "Expand i18n system for complete coverage",
        "Create folder structure (handlers/, services/, models/)",
        "Implement FSM for complex dialogs",
        "Add docstrings in Russian"
      ]
    },
    "phase_3": {
      "name": "Testing & Validation (1 week)",
      "priority": "MEDIUM",
      "tasks": [
        "Add unit tests for critical functions",
        "Add integration tests for callbacks",
        "Verify i18n for all scenarios",
        "Performance testing under load"
      ]
    }
  },
  "key_findings": {
    "strength_1": "Well-organized by functionality (13 clear categories)",
    "strength_2": "Comprehensive coverage of features (from learning to crypto)",
    "strength_3": "Good use of async/await for I/O operations",
    "weakness_1": "One function (button_callback) is extremely large",
    "weakness_2": "Significant duplication of Russian text strings",
    "weakness_3": "Incomplete internationalization support"
  },
  "recommended_priority_matrix": {
    "high_impact_low_effort": [
      "Create constants.py for Russian strings",
      "Add type hints",
      "Create button_callback dispatcher"
    ],
    "high_impact_high_effort": [
      "Complete refactoring of button_callback",
      "Expand i18n system",
      "Create folder-based architecture"
    ],
    "low_impact_low_effort": [
      "Standardize error message format",
      "Add docstrings",
      "Code style improvements"
    ]
  },
  "next_steps": {
    "immediate": "Review ANALYSIS_SUMMARY.md for quick understanding",
    "short_term": "Create constants.py and split button_callback",
    "medium_term": "Implement full i18n and new architecture",
    "long_term": "Add comprehensive testing and monitoring"
  },
  "analysis_complete": true,
  "timestamp": "2025-12-26T12:00:00Z"
}
