#!/usr/bin/env python3
"""
–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ v0.21.1

–ü—Ä–æ–±–ª–µ–º—ã –≤ v0.21.0:
‚ùå –û—Ç–≤–µ—Ç—ã –≤—ã–≥–ª—è–¥–µ–ª–∏ –∫–∞–∫ –∑–∞—Å–∫—Ä–∏–ø—Ç–æ–≤–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
‚ùå –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è
‚ùå Follow-up –≤–æ–ø—Ä–æ—Å—ã –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ —Å–≤—è–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚ùå –î–∏–∞–ª–æ–≥ –∫–∞–∑–∞–ª—Å—è —Ä–æ–±–æ—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º

–†–µ—à–µ–Ω–∏—è –≤ v0.21.1:
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç-–æ—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚úÖ –í–∞—Ä–∏–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è —à–∞–±–ª–æ–Ω—ã)
‚úÖ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ follow-up –≤–æ–ø—Ä–æ—Å–æ–≤
‚úÖ –ë–æ–ª–µ–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏
"""

import random
from typing import Dict, List, Optional

# ==================== –ï–°–¢–ï–°–¢–í–ï–ù–ù–´–ï –î–ò–ê–õ–û–ì–ò v0.21.1 ====================

def get_natural_response(
    user_message: str,
    intent: str,
    context_history: List[dict] = None,
    user_profile: dict = None
) -> Optional[str]:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è.
    
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - user_message: —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - intent: –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (news_analysis, question, follow_up, general_chat)
    - context_history: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3-5 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    - user_profile: –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–Ω—Ç–µ—Ä–µ—Å—ã, –ø–æ—Ä—Ç—Ñ–µ–ª—å)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–ª–∏ None –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–µ–∑ API
    """
    
    context_history = context_history or []
    user_profile = user_profile or {}
    
    # –ò—â–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è follow-up
    prev_message = None
    if context_history and len(context_history) >= 2:
        prev_message = context_history[1] if context_history[1]['type'] == 'user' else (
            context_history[0] if context_history[0]['type'] == 'user' else None
        )
    
    # ==================== FOLLOW-UP –í–û–ü–†–û–°–´ ====================
    if intent == "follow_up":
        return _handle_followup(user_message, prev_message, context_history)
    
    # ==================== –û–ë–©–ò–ï –í–û–ü–†–û–°–´ ====================
    if intent == "question":
        return _handle_question(user_message, context_history, user_profile)
    
    # ==================== –û–ë–©–ê–Ø –ë–ï–°–ï–î–ê ====================
    if intent == "general_chat":
        return _handle_general_chat(user_message, context_history)
    
    # ==================== –ù–û–í–û–°–¢–ò - –¢–†–ï–ë–£–ï–¢ API ====================
    # –î–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π –≤—Å–µ —Ä–∞–≤–Ω–æ –∏–¥–µ–º –Ω–∞ API (—Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤)
    return None


def _handle_followup(
    user_message: str,
    prev_message: Optional[dict],
    context_history: List[dict]
) -> str:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ follow-up –≤–æ–ø—Ä–æ—Å–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞."""
    
    text_lower = user_message.lower()
    
    # –ï—Å–ª–∏ —ç—Ç–æ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –ø–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –æ—Ç–≤–µ—Ç—É
    if any(w in text_lower for w in ["–ø–æ–¥—Ä–æ–±–Ω–µ–µ", "–µ—â–µ", "—Ä–∞—Å—Å–∫–∞–∂–∏ –±–æ–ª—å—à–µ", "–¥–µ—Ç–∞–ª—å–Ω–µ–µ"]):
        responses = [
            "–î–∞–π –º–Ω–µ –ø–æ–¥—É–º–∞—Ç—å... ü§î –ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?",
            "–•–æ—Ä–æ—à–æ, —Ä–∞—Å—Å–∫–∞–∂—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ! üìö –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ?",
            "–ú–Ω–µ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π - –æ —á–µ–º —Ç—ã —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?",
        ]
        return random.choice(responses)
    
    # –ï—Å–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å "–ø–æ—á–µ–º—É" –∏–ª–∏ "–∫–∞–∫"
    if any(w in text_lower for w in ["–ø–æ—á–µ–º—É", "–∫–∞–∫", "–±–ª–∞–≥–æ–¥–∞—Ä—è —á–µ–º—É", "–∏–∑-–∑–∞"]):
        responses = [
            "–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! üéØ –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º—Å—è...",
            "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –≠—Ç–æ –Ω—É–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å. –î–∞–π –º–∏–Ω—É—Ç—É... üß†",
            "–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏—á–∏–Ω...",
        ]
        return random.choice(responses) + "\n\n" + (
            "–°–∫–∞–∂–∏ –º–Ω–µ —Ç–æ—á–Ω–µ–µ, —á—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç, –∏ —è –ø–æ–º–æ–≥—É! üí°"
        )
    
    # –û–±—â–µ–µ —É—Ç–æ—á–Ω–µ–Ω–∏–µ
    responses = [
        "–ü–æ–Ω–∏–º–∞—é –≤–æ–ø—Ä–æ—Å! üëÇ –î–∞–π –º–Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—É—á—à–µ.",
        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –º—ã—Å–ª—å! üí≠ –£—Ç–æ—á–Ω–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.",
        "–Ø –Ω–∞ —ç—Ç–æ —Å–º–æ—Ç—Ä—é –ø–æ-–¥—Ä—É–≥–æ–º—É... üîç –ß—Ç–æ –∏–º–µ–Ω–Ω–æ?",
    ]
    return random.choice(responses)


def _handle_question(
    user_message: str,
    context_history: List[dict],
    user_profile: dict
) -> str:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–± –æ–±—É—á–µ–Ω–∏–∏."""
    
    text_lower = user_message.lower()
    
    # –í–æ–ø—Ä–æ—Å—ã –æ Bitcoin/–∫—Ä–∏–ø—Ç–æ
    if any(w in text_lower for w in ["bitcoin", "–±–∏—Ç–∫–æ–π–Ω", "–∫—Ä–∏–ø—Ç–æ", "–±–ª–æ–∫—á–µ–π–Ω", "–±–ª–æ–∫"]):
        responses = [
            "Bitcoin? –≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ! üîê –≠—Ç–æ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª—é—Ç–∞, –ø–µ—Ä–≤–∞—è –∏–∑ —Å–≤–æ–∏—Ö...",
            "–û Bitcoin! üí∞ –•–æ—Ä–æ—à–µ–µ –Ω–∞—á–∞–ª–æ –¥–ª—è –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è –≤ –∫—Ä–∏–ø—Ç–æ.",
            "–•–æ—Ä–æ—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è! üöÄ Bitcoin –±—ã–ª –ø–µ—Ä–≤–æ–π..."
        ]
        return random.choice(responses) + "\n\n" + (
            "–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –ø—Ä–æ —Ü–µ–Ω—É, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—é? üìä"
        )
    
    # –í–æ–ø—Ä–æ—Å—ã –æ DeFi
    if any(w in text_lower for w in ["defi", "–¥–µ—Ñ–∏", "—Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç", "–∫–æ–Ω—Ç—Ä–∞–∫—Ç", "—Ç–æ–∫–µ–Ω"]):
        responses = [
            "DeFi - –æ—Ç–ª–∏—á–Ω–∞—è —Ç–µ–º–∞! üåê –≠—Ç–æ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...",
            "–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—à—å—Å—è DeFi? üí° –≠—Ç–æ –±—ã—Å—Ç—Ä–æ—Ä–∞—Å—Ç—É—â–∏–π —Å–µ–∫—Ç–æ—Ä –∫—Ä–∏–ø—Ç–æ.",
            "–°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã? üîó –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –≤—Å–µ–π DeFi —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã."
        ]
        return random.choice(responses) + "\n\n" + (
            "–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ –∫–∞–∫–∏–µ –µ—Å—Ç—å —Ä–∏—Å–∫–∏? ‚ö†Ô∏è"
        )
    
    # –í–æ–ø—Ä–æ—Å—ã –æ –ø–æ—Ä—Ç—Ñ–µ–ª–µ
    if any(w in text_lower for w in ["–ø–æ—Ä—Ç—Ñ–µ–ª—å", "–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å", "–ø–æ–∫—É–ø–∫–∞", "—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ"]):
        responses = [
            "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º - –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É! üìà –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º—Å—è...",
            "–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å –æ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏! üéØ –í—Å–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è —Ä–∏—Å–∫–∞.",
            "–ü–æ—Ä—Ç—Ñ–µ–ª—å? üíº –≠—Ç–æ –¥–æ–ª–≥–∞—è –∏—Å—Ç–æ—Ä–∏—è, –Ω–æ –Ω–∞—á–Ω–µ–º —Å –æ—Å–Ω–æ–≤!"
        ]
        return random.choice(responses) + "\n\n" + (
            "–ö–∞–∫–æ–π —É —Ç–µ–±—è —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞? (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π/—É–º–µ—Ä–µ–Ω–Ω—ã–π/–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)"
        )
    
    # –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
    responses = [
        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! ü§î –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –≤–º–µ—Å—Ç–µ.",
        "–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! üí≠ –ú–Ω–µ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.",
        "–î—É–º–∞—é –Ω–∞–¥ —ç—Ç–∏–º... üß† –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ!",
    ]
    return random.choice(responses)


def _handle_general_chat(
    user_message: str,
    context_history: List[dict]
) -> str:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—â–µ–π –±–µ—Å–µ–¥—ã."""
    
    text_lower = user_message.lower()
    
    # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
    if any(w in text_lower for w in ["–ø—Ä–∏–≤–µ—Ç", "–ø—Ä–∏–≤–µ—Ç!", "–∫—É–ª–ª", "–∫—É", "hi", "hello", "hey"]):
        responses = [
            "–ü—Ä–∏–≤–µ—Ç! üëã –†–∞–¥ –≤–∏–¥–µ—Ç—å —Ç–µ–±—è!",
            "–≠–π! üëç –ß—Ç–æ –Ω–æ–≤–æ–≥–æ?",
            "–ü—Ä–∏–≤–µ—Ç! ü§ñ –ö–∞–∫ –¥–µ–ª–∞?",
            "–•–µ–π! üòä –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å?",
        ]
        return random.choice(responses) + "\n\n–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –Ω–æ–≤–æ—Å—Ç—å –ø—Ä–æ –∫—Ä–∏–ø—Ç–æ, –∏ —è –µ—ë —Ä–∞–∑–±–µ—Ä—É! üì∞"
    
    # –í–æ–ø—Ä–æ—Å—ã "–∫–∞–∫ –¥–µ–ª–∞", "—á—Ç–æ –¥–µ–ª–∞–µ—à—å"
    if any(w in text_lower for w in ["–∫–∞–∫ –¥–µ–ª–∞", "—á—Ç–æ –¥–µ–ª–∞–µ—à—å", "–∫–∞–∫ —Ç—ã", "—á—Ç–æ —Ç—ã —Ç–∞–º"]):
        responses = [
            "–í—Å–µ —Ö–æ—Ä–æ—à–æ! üòÑ –Ø –∂–¥—É –∫—Ä–∏–ø—Ç–æ-–Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.",
            "–û—Ç–ª–∏—á–Ω–æ! üöÄ –ì–æ—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏.",
            "–†–∞–±–æ—Ç–∞—é! üí™ –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –∫—Ä–∏–ø—Ç–æ.",
        ]
        return random.choice(responses) + "\n\n–ï—Å—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤ –∫—Ä–∏–ø—Ç–æ-–º–∏—Ä–µ? üîç"
    
    # –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å
    if any(w in text_lower for w in ["—Å–ø–∞—Å–∏–±–æ", "—Å–ø–∞—Å–∏–±", "thanks", "thx", "–±–ª–∞–≥–æ–¥–∞—Ä"]):
        responses = [
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üòä –†–∞–¥ –ø–æ–º–æ—á—å!",
            "–ù–∞ –∑–¥–æ—Ä–æ–≤—å–µ! üíô –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –µ—â—ë - —è –∑–¥–µ—Å—å!",
            "–í—Å–µ–≥–¥–∞ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞! üôè –ï—Å—Ç—å –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã?",
        ]
        return random.choice(responses)
    
    # –í–æ–ø—Ä–æ—Å—ã —á—Ç–æ –±–æ—Ç –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å
    if any(w in text_lower for w in ["—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å", "—á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å", "—Ç–≤–æ–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏", "—Ç–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏"]):
        abilities = [
            "üì∞ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏–ø—Ç–æ-–Ω–æ–≤–æ—Å—Ç–∏",
            "üìä –û–±—ä—è—Å–Ω—è—Ç—å —Ç—Ä–µ–Ω–¥—ã –Ω–∞ —Ä—ã–Ω–∫–µ",
            "üí° –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –∫—Ä–∏–ø—Ç–æ",
            "üéì –£—á–∏—Ç—å –ø—Ä–æ DeFi –∏ Web3",
            "üí∞ –ü–æ–º–æ–≥–∞—Ç—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ"
        ]
        return "–Ø —É–º–µ—é:\n\n" + "\n".join(abilities) + "\n\n" + (
            "–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –Ω–æ–≤–æ—Å—Ç—å –∏–ª–∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å! üöÄ"
        )
    
    # –û–±—â–∏–µ –æ—Ç–≤–µ—Ç—ã
    responses = [
        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! ü§î –†–∞—Å—Å–∫–∞–∑—ã–≤–∞–π!",
        "–≠—Ç–æ –∫—Ä—É—Ç–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ! üí≠ –ß—Ç–æ –µ—â—ë?",
        "–°–æ–≥–ª–∞—Å–µ–Ω! üëç –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ!",
        "–•–º, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ... üß† –ü—Ä–æ–¥–æ–ª–∂–∞–π!",
    ]
    return random.choice(responses) + "\n\n" + (
        "–ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ –∫—Ä–∏–ø—Ç–æ-–Ω–æ–≤–æ—Å—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞! üì∞"
    )


# ==================== –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í BOT.PY ====================

def get_conversational_response_improved(
    user_message: str,
    intent: str,
    user_id: int,
    context_history: List[dict] = None
) -> Optional[str]:
    """
    –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è bot.py handle_message()
    
    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    ```python
    # –í handle_message():
    response = get_conversational_response_improved(
        user_text, 
        intent, 
        user.id,
        get_conversation_history(user.id, limit=5)
    )
    if response:
        await update.message.reply_text(response, parse_mode=ParseMode.HTML)
        return
    ```
    """
    
    # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ bot.py –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –ø—Ä–æ—Ñ–∏–ª–∏
    try:
        from bot import get_user_profile
        profile = get_user_profile(user_id)
    except:
        profile = None
    
    return get_natural_response(user_message, intent, context_history, profile)


# ==================== –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø ====================

if __name__ == "__main__":
    print("=" * 60)
    print("ü§ñ –ü–†–ò–ú–ï–†–´ –ï–°–¢–ï–°–¢–í–ï–ù–ù–û–ì–û –î–ò–ê–õ–û–ì–ê v0.21.1")
    print("=" * 60)
    
    examples = [
        # Follow-up –ø—Ä–∏–º–µ—Ä—ã
        {
            "message": "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± —ç—Ç–æ–º",
            "intent": "follow_up",
            "title": "Follow-up: –ø—Ä–æ—Å—å–±–∞ –ø–æ–¥—Ä–æ–±–Ω–µ–µ"
        },
        {
            "message": "–ü–æ—á–µ–º—É?",
            "intent": "follow_up",
            "title": "Follow-up: —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å"
        },
        
        # –í–æ–ø—Ä–æ—Å—ã –ø—Ä–∏–º–µ—Ä—ã
        {
            "message": "–ß—Ç–æ —Ç–∞–∫–æ–µ Bitcoin?",
            "intent": "question",
            "title": "–í–æ–ø—Ä–æ—Å: –æ Bitcoin"
        },
        {
            "message": "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–ª–æ–∫—á–µ–π–Ω?",
            "intent": "question",
            "title": "–í–æ–ø—Ä–æ—Å: –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"
        },
        
        # –û–±—â–∞—è –±–µ—Å–µ–¥–∞ –ø—Ä–∏–º–µ—Ä—ã
        {
            "message": "–ü—Ä–∏–≤–µ—Ç!",
            "intent": "general_chat",
            "title": "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"
        },
        {
            "message": "–ß—Ç–æ —Ç—ã —É–º–µ–µ—à—å?",
            "intent": "general_chat",
            "title": "–í–æ–ø—Ä–æ—Å –æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö"
        },
        {
            "message": "–ö–∞–∫ –¥–µ–ª–∞?",
            "intent": "general_chat",
            "title": "–û–±—â–µ–Ω–∏–µ"
        },
    ]
    
    for example in examples:
        print(f"\n{'‚îÄ' * 60}")
        print(f"üìù {example['title']}")
        print(f"{'‚îÄ' * 60}")
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: \"{example['message']}\"")
        print(f"Intent: {example['intent']}")
        print()
        
        response = get_natural_response(
            example['message'],
            example['intent']
        )
        
        if response:
            print(f"‚úÖ –ë–æ—Ç (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç):\n{response}")
        else:
            print(f"üìä –ë–æ—Ç: –ù—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ API")
    
    print("\n" + "=" * 60)
    print("‚úÖ –í–°–ï –ü–†–ò–ú–ï–†–´ –í–´–ü–û–õ–ù–ï–ù–´")
    print("=" * 60)
