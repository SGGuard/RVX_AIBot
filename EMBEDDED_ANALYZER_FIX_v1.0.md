# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ HTTP 502 Bad Gateway v1.0

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞–Ω–∞–ª–∏–∑–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –±–æ—Ç –≤—ã–¥–∞–≤–∞–ª –æ—à–∏–±–∫—É:
```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ
–°—Ç–∞—Ç—É—Å: HTTP 502 Bad Gateway
```

**–ü—Ä–∏—á–∏–Ω–∞**: API —Å–µ—Ä–≤–µ—Ä –Ω–∞ Railway –±—ã–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. On Railway —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ —Ç–æ–ª—å–∫–æ bot.py, –Ω–æ –±–æ—Ç –ø—ã—Ç–∞–ª—Å—è –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–Ω–µ—à–Ω–µ–π API –Ω–∞ `https://web-production-ddd5.up.railway.app/explain_news` –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π** (embedded_news_analyzer.py) –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–µ–π API.

### –§–∞–π–ª—ã, –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:

1. **bot.py** - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `call_api_with_retry` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
2. **embedded_news_analyzer.py** - –ù–æ–≤—ã–π –º–æ–¥—É–ª—å —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º (—Å–æ–∑–¥–∞–Ω)
3. **test_embedded_analyzer.py** - –¢–µ—Å—Ç—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ (—Å–æ–∑–¥–∞–Ω)

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

### Multi-Provider Fallback Chain

–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä AI –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1. **Groq** (mixtral-8x7b-32768)
   - ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: ~1-2 —Å–µ–∫
   - üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
   - ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
   - –¢—Ä–µ–±—É–µ—Ç: `GROQ_API_KEY`

2. **Mistral** (mistral-large-latest)
   - ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: ~3-5 —Å–µ–∫
   - üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
   - üîÑ –ü–µ—Ä–≤—ã–π fallback
   - –¢—Ä–µ–±—É–µ—Ç: `MISTRAL_API_KEY`

3. **DeepSeek** (deepseek-chat)
   - ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: ~2-3 —Å–µ–∫
   - üí≥ OpenAI compatible
   - üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
   - –¢—Ä–µ–±—É–µ—Ç: `DEEPSEEK_API_KEY`

4. **Gemini** (gemini-2.5-flash)
   - ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: ~5-10 —Å–µ–∫
   - üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (20 req/day)
   - üîÑ –ü–æ—Å–ª–µ–¥–Ω–∏–π fallback
   - –¢—Ä–µ–±—É–µ—Ç: `GEMINI_API_KEY`

5. **Fallback Response**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∫–µ–ª–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑, –∫–æ–≥–¥–∞ –≤—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
   - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∏—Ç –∫–∞–∫–æ–π-—Ç–æ –æ—Ç–≤–µ—Ç

### JSON –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –û—Ç–≤–µ—Ç–∞

–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON:

```json
{
  "summary_text": "2-3 –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞ –∞–Ω–∞–ª–∏–∑–∞ (200-300 —Å–ª–æ–≤)",
  "impact_points": ["Point 1", "Point 2", "Point 3"],
  "provider": "groq|mistral|deepseek|gemini|fallback",
  "cached": false,
  "processing_time_ms": 1982
}
```

### –§—É–Ω–∫—Ü–∏–∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç prompt injection** - –æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è
‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** - –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞** - –º–∞–∫—Å–∏–º—É–º 4096 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è Telegram
‚úÖ **Timeout protection** - –∫–∞–∂–¥—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏–º–µ–µ—Ç —Ç–∞–π–º–∞—É—Ç

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –¢—Ä–µ–±—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä:
GROQ_API_KEY=xxx                    # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–±—ã—Å—Ç—Ä–æ)
MISTRAL_API_KEY=xxx                 # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
DEEPSEEK_API_KEY=xxx                # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
GEMINI_API_KEY=xxx                  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
GROQ_MODEL=mixtral-8x7b-32768
GROQ_TIMEOUT=5

MISTRAL_MODEL=mistral-large-latest
MISTRAL_TIMEOUT=10

DEEPSEEK_MODEL=deepseek-chat
DEEPSEEK_TIMEOUT=10

GEMINI_MODEL=models/gemini-2.5-flash
GEMINI_TIMEOUT=30
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ

```python
from embedded_news_analyzer import analyze_news

# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤–æ—Å—Ç—å
result = await analyze_news(
    news_text="Bitcoin reached $100,000...",
    user_id=7216426044
)

# –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
print(result["simplified_text"])  # –ê–Ω–∞–ª–∏–∑
print(result["impact_points"])    # –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã
print(result["provider"])          # –ö–∞–∫–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
print(result["processing_time_ms"])  # –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
================================================================================
üß™ –¢–ï–°–¢: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π v1.0
================================================================================

üì∞ –¢–µ—Å—Ç #1: Bitcoin ATH
‚úÖ Provider: groq
‚úÖ Processing: 1982ms
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: OK

üì∞ –¢–µ—Å—Ç #2: Ethereum Shanghai
‚úÖ Provider: groq
‚úÖ Processing: 1321ms
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: OK

üì∞ –¢–µ—Å—Ç #3: Tesla AI Chip
‚úÖ Provider: groq
‚úÖ Processing: 1592ms
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: OK

‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!
================================================================================
```

## üîß –ú–∏–≥—Ä–∞—Ü–∏—è —Å API –Ω–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

**–ë—ã–ª–æ:**
```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ - –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–π API
response = await client.post(
    API_URL_NEWS,  # https://web-production-ddd5.up.railway.app/explain_news
    json={"text_content": news_text}
)
```

**–°—Ç–∞–ª–æ:**
```python
# –ù–æ–≤—ã–π –∫–æ–¥ - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
result = await analyze_news(news_text, user_id=user_id)
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–µ–π API** - —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ
‚úÖ **–ù–µ—Ç 502 Bad Gateway –æ—à–∏–±–æ–∫** - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç–æ–º –∂–µ –ø—Ä–æ—Ü–µ—Å—Å–µ
‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ** - –Ω–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ API
‚úÖ **–ù–∞–¥–µ–∂–Ω–µ–µ** - auto-fallback –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ** - –≤—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ .env
‚úÖ **–≠–∫–æ–Ω–æ–º–Ω–µ–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Groq, Mistral)

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
cd /home/sv4096/rvx_backend

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
python3 test_embedded_analyzer.py

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä)
python3 bot.py

# –ò–ª–∏ –Ω–∞ Railway:
python3 main.py  # (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞)
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º:

```
‚úÖ Groq analysis successful in 1982ms
üíæ Cache HIT: 351a4c114a42...
‚ÜîÔ∏è Trying Mistral...
‚ùå Mistral failed: Connection timeout
üîÑ Analyzing with fallback chain...
üì∞ Analyzing with fallback chain: 191 chars | User: 7216426044
```

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Groq API key not configured"
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `GROQ_API_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env` —Ñ–∞–π–ª–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "All providers failed, using fallback response"
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: "Timeout after 5s"
**–†–µ—à–µ–Ω–∏–µ**: –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ `.env`:
```bash
GROQ_TIMEOUT=10
MISTRAL_TIMEOUT=15
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å–æ —Å—Ç–∞—Ä–æ–π API
- –í—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π system prompt –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- Fallback –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑ AI –æ–±—Ä–∞–±–æ—Ç–∫–∏

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω
- ‚úÖ bot.py –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –Ω–∞ Railway

---

**Version**: 1.0
**Date**: 2025-12-22
**Status**: ‚úÖ Production Ready
